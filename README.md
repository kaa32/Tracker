**Table of Contents**  *generated with [DocToc](http://doctoc.herokuapp.com/)*

- [Авторизация](#Авторизация)
	- [Получение токена авторизации устройства](#Получение-токена-авторизации-устройства)
			- [Входные параметры](#Входные-параметры)
			- [Пример ответа](#Пример-ответа)
- [Регистрация](#Регистрация)
	- [Запрос на регистрацию](#Запрос-на-регистрацию)
			- [Входные параметры](#Входные-параметры-1)
			- [Пример ответа](#Пример-ответа-1)
	- [Выход](#Выход)
			- [Пример ответа](#Пример-ответа-1)
	- [Проверка занятости имени пользователя](#Проверка-занятости-имени-пользователя)
			- [Входные параметры](#Входные-параметры-2)
			- [Пример ответа](#Пример-ответа-2)
	- [Проверка занятости логина](#Проверка-занятости-логина)
			- [Входные параметры](#Входные-параметры-3)
			- [Пример ответа](#Пример-ответа-3)
- [Управление профайлом](#Управление-профайлом)
	- [Обновление данных профиля](#Обновление-данных-профиля)
			- [Входные параметры](#Входные-параметры-4)
			- [Пример ответа](#Пример-ответа-4)
	- [Обновление аватары профиля](#Обновление-аватары-профиля)
			- [Входные параметры](#Входные-параметры-5)
			- [Пример ответа](#Пример-ответа-5)
			- [Входные параметры](#Входные-параметры-6)
			- [Пример ответа](#Пример-ответа-6)
	- [Удаление профиля из сервиса](#Удаление-профиля-из-сервиса)
			- [Входные параметры](#Входные-параметры-7)
			- [Пример ответа](#Пример-ответа-7)
- [Пользователи](#Пользователи)
	- [Получение данных пользователя](#Получение-данных-пользователя)
			- [Входные параметры](#Входные-параметры-8)
			- [Пример ответа](#Пример-ответа-8)
	- [Получение списка устройств пользователя](#Получение-списка-устройств-пользователя)
			- [Входные параметры](#Входные-параметры-9)
			- [Пример ответа](#Пример-ответа-9)
	- [Поток обновлений](#Поток-обновлений)
			- [Входные параметры](#Входные-параметры-10)
			- [Пример ответа](#Пример-ответа-10)
	- [Сигнал SOS](#Сигнал-sos)
			- [Входные параметры](#Входные-параметры-11)
	- [Получение позиции](#Получение-позиции)
		- [Входные параметры](#Входные-параметры-10)
		- [Пример ответа](#Пример-ответа-10)
	- [Получение движения пользователя за период](#Получение-движения-пользователя-за-период)
		- [Входные параметры](#Входные-параметры-10)
		- [Пример ответа](#Пример-ответа-10)
- [Круги](#Круги)
	- [Получение данных круга](#Получение-данных-круга)
			- [Входные параметры](#Входные-параметры-12)
			- [Пример ответа](#Пример-ответа-11)
	- [Создание круга](#Создание-круга)
			- [Входные параметры](#Входные-параметры-13)
			- [Пример ответа](#Пример-ответа-12)
	- [Обновление данных круга](#Обновление-данных-круга)
			- [Входные параметры](#Входные-параметры-14)
			- [Пример ответа](#Пример-ответа-13)
	- [Удаление круга](#Удаление-круга)
			- [Входные параметры](#Входные-параметры-15)
			- [Пример ответа](#Пример-ответа-14)
	 [Добавление участника круга по логину](#Добавление-участника-круга-по-логину)
			- [Входные параметры](#Входные-параметры-16)
			- [Пример ответа](#Пример-ответа-15)
	 [Добавление участника круга по имени](#Добавление-участника-круга-по-имени)
			- [Входные параметры](#Входные-параметры-16)
			- [Пример ответа](#Пример-ответа-15)
	- [Удаление участника круга](#Удаление-участника-круга)
			- [Входные параметры](#Входные-параметры-17)
			- [Пример ответа](#Пример-ответа-16)
	- [Принятие отказ приглашения в круг](#Принятие-отказ-приглашения-в-круг)
			- [Входные параметры](#Входные-параметры-17)
- [Устройства](#Устройства)
	- [Получение данных устройства](#Получение-данных-устройства)
			- [Входные параметры](#Входные-параметры-18)
			- [Пример ответа](#Пример-ответа-17)
	- [Создание устройства](#Создание-устройства)
			- [Входные параметры](#Входные-параметры-19)
			- [Пример ответа](#Пример-ответа-18)
	- [Обновление данных устройства](#Обновление-данных-устройства)
			- [Входные параметры](#Входные-параметры-20)
			- [Пример ответа](#Пример-ответа-19)
	- [Удаление устройства](#Удаление-устройства)
			- [Входные параметры](#Входные-параметры-21)
			- [Пример ответа](#Пример-ответа-20)
	- [Настройки устройства](#Настройки-устройства)
	- [Установка устройства в качестве master](#Установка-устройства-в-качестве-master)
- [GEO данные](#Geo-данные)
	- [Прием данных от устройства](#Прием-данных-от-устройства)
			- [Входные параметры](#Входные-параметры-22)
			- [Пример ответа](#Пример-ответа-21)
	- [Создание зоны](#Создание-зоны)
			- [Входные параметры](#Входные-параметры-22)
	- [Обновление данных зоны](#Обновление-данных-зоны)
	- [Удаление зоны](#Удаление-зоны)
	- [Приглашение в зону по логину](#Приглашение-в-зону-по-логину)
			- [Входные параметры](#Входные-параметры-22)
	- [Приглашение в зону по имени](#Приглашение-в-зону-по-имени)
			- [Входные параметры](#Входные-параметры-22)
	- [Принятие отказ приглашения в зону](#Принятие-отказ-приглашения-в-зону)
			- [Входные параметры](#Входные-параметры-22)
- [Личные сообщения](#Личные-сообщения)
	- [Список сообщений сгруппированных по пользователю](#Список-сообщений-сгруппированных-по-пользователю)
			- [Входные параметры](#Входные-параметры-23)
			- [Пример ответа](#Пример-ответа-22)
	- [Список сообщений конкретного пользователя](#Список-сообщений-конкретного-пользователя)
	- [Отправка сообщения](#Отправка-сообщения)
			- [Входные параметры](#Входные-параметры-24)
			- [Пример ответа](#Пример-ответа-23)
	- [Пометка о прочтении сообщения](#Пометка-о-прочтении-сообщения)
			- [Входные параметры](#Входные-параметры-25)
			- [Пример ответа](#Пример-ответа-24)
	- [Восстановление удаленного сообщения](#Восстановление-удаленного-сообщения)
			- [Входные параметры](#Входные-параметры-26)
			- [Пример ответа](#Пример-ответа-25)
	- [Удаление сообщения](#Удаление-сообщения)
			- [Входные параметры](#Входные-параметры-27)
- [Оповещения системы](#Оповещения-системы)
	- [Отметка оповещения как прочитанного](#Отметка-оповещения-как-прочитанного)
			- [Входные параметры](#Входные-параметры-28)
	- [Оповещения](#Оповещения)
			- [Пример ответа](#Пример-ответа-25)
- [Объекты API](#Объекты-api)
	- [USER object](#user-object)
	- [USER TRIMMED object](#user-trimmed-object)
	- [CIRCLE object](#circle-object)
	- [CIRCLE TRIMMED object](#circle-trimmed-object)
	- [DEVICE object](#device-object)
	- [GEOZONE object](#geozone-object)
	- [GEOZONE TRIMMED object](#geozone-trimmed-object)
	- [MESSAGE object](#message-object)
	- [CONFIRM object](#confirm-object)
	- [ALERT object](#alert-object)

# Авторизация #
## Получение токена авторизации устройства ##
URI: oauth/token/  
Метод: POST  

#### Входные параметры
string username - логин пользователя  
string password - пароль пользователя  
string device_uuid - Уникальный идентификатор устройства  
string language - язык пользователя

#### Пример ответа
При успешной авторизации:  
HTTP код ответа: 200.  
Параметры  
access_token  – Токен который будет использоваться для авторизации в сервисах  
user_id    – Идентификатор пользователя  
expires_in     – Время истечения токена.  

{"access_token":"51ee8ab7428918.52720767","user_id":1,"expires_in":31536000}  

При неуспешной авторизации:  
HTTP код ответа 401.  

# Регистрация
## Запрос на регистрацию
URI: register  
Метод: GET/POST  

#### Входные параметры
user_name - Имя пользователя
user_login - Логин (email)
user_password - Пароль
user_phone - Телефон

#### Пример ответа
user_id - id нового пользователя

## Выход
URI: /logout
Метод: GET/POST

#### Пример ответа
При успешном выходе нет данных

При отсутствии авторизации 
HTTP код ответа 401. 

## Проверка занятости имени пользователя
register/nameisavailable  
Метод: GET/POST  
#### Входные параметры
value - значение для проверки  
#### Пример ответа
{"result": true|false}  

## Проверка занятости логина
register/loginisavailable  
Метод: GET/POST  
#### Входные параметры
value - значение для проверки
#### Пример ответа
{"result": true|false} 

# Управление профайлом

## Обновление данных профиля
account/update_profile  
Метод: POST
#### Входные параметры
name  Имя пользователя (должно быть уникальным)  
phone  Телефон пользователя (должно быть уникальным)  
#### Пример ответа
[Объект USER](#user-object)  

## Обновление аватары профиля  
account/update_profile_image   
Метод: POST  
#### Входные параметры  
image - картинка JPG/PNG/GIF в BASE64 или залитый через механизм input type=file name=image файл  
#### Пример ответа
[Объект USER](#user-object)  

account/update_profile_password  
Метод: POST  
#### Входные параметры  
old_password - пароль от аккаунта
new_password - новый пароль 
repeat_new_password - новый пароль 
#### Пример ответа  
{"result": true|false} 

## Удаление профиля из сервиса
account/destroy  
Метод: POST  
#### Входные параметры  
key - ключ удаления
#### Пример ответа  
{"result": true|false}  

# Пользователи  
## Получение данных пользователя  
URI: users/show  
Метод: GET/POST  
#### Входные параметры  
id - id пользователя (или нескольких пользователей через запятую)  
#### Пример ответа  
[Объект USER](#user-object) или массив [Объект USER](#user-object)  

## Получение списка устройств пользователя (не существует)
URI: users/devices  
Метод: GET/POST  
#### Входные параметры  
id - id пользователя (или нескольких пользователей через запятую)  

#### Пример ответа  
Массив [Объект DEVICE](#device-object)  

## Поток обновлений  
users/updates  
Метод: GET
#### Входные параметры  
#### Пример ответа  

## Сигнал SOS  
URI: users/sos  
Метод: GET/POST  
#### Входные параметры
Нет

## Получение позиции
URI: users/position

#### Входные параметры
uid - id пользователя или пользователей

#### Пример ответа
{
    uid: 0,
    pos: [Объект POSITION](#position-object) 
}

## Получение движения пользователя за период
URI: users/track

#### Входные параметры
uid - id пользователя или пользователей
starts - начало интересующего периода в формате unix-time
end - конец интересующего периода в формате unix-time

#### Пример ответа
{
    [Объект POSITION](#position-object),
    [Объект POSITION](#position-object)
}

# Круги
## Получение данных круга  
URI: circles/show  
Метод: GET/POST  

#### Входные параметры  
id - id круга (или нескольких кругов через запятую)  

#### Пример ответа  
[Объект CIRCLE](#circle-object)

## Создание круга  
URI: circles/create  
Метод: POST  
#### Входные параметры  

name – имя круга  
members – user_id через запятую  

#### Пример ответа  
[Объект CIRCLE](#group-object)  

## Обновление данных круга  
URI: circles/update  
Метод: POST  

#### Входные параметры  

circle_id – id круга  
name – имя круга  
description - описание круга

#### Пример ответа
[Объект CIRCLE](#circle-object)  

## Удаление круга
URI: circles/destroy  
Метод: POST  

#### Входные параметры

circle_id – id круга  

#### Пример ответа

## Добавление участника круга по логину
URI: circles/members/addbylogin
Метод: POST  
#### Входные параметры
user_login - логин пользователя
circle_id - id круга

#### Пример ответа
{result:true}

## Добавление участника круга по имени
URI: circles/members/addbyname  
Метод: POST

#### Входные параметры
user_name - имя пользователя
circle_id - id круга

#### Пример ответа
{result:true}

## Удаление участника круга  
URI: circles/members/destroy  
Метод: POST  

#### Входные параметры  
user_id - id пользователя
circle_id - id круга

#### Пример ответа  
[Объект CIRCLE](#circle-object)  

## Принятие отказ приглашения в круг
URI: circles/confirm 
Метод: POST

#### Входные параметры
confirmation_token - токен приглашения
status - true=принятие, false=отказ (bool)

# Устройства  

## Получение данных устройства  
URI: devices/show  
Метод: GET/POST  
#### Входные параметры  
id - id устройства (или нескольких через запятую)  

#### Пример ответа  
[Объект DEVICE](#device-object) или массив [Объект DEVICE](#device-object)

## Создание устройства  
URI: device/create  
Метод: POST  

#### Входные параметры  
name - имя устройства  

#### Пример ответа  
[Объект DEVICE](#device-object)

## Обновление данных устройства  
URI: device/update  
Метод: POST  

#### Входные параметры  
name - имя устройства  

#### Пример ответа  
[Объект DEVICE](#device-object)

## Удаление устройства  
URI: device/destroy  
Метод: POST  
#### Входные параметры  

#### Пример ответа  

## Настройки устройства
URI: device/settings  
Метод: GET  

## Установка устройства в качестве master
URI: device/master

# GEO данные  

## Прием данных от устройства  
URI: geo/receive  
Метод: POST  
#### Входные параметры  
data - строка в формате JSON или NMEA GGA/GLL
#### Пример ответа  
{"result": true|false} 

## Создание зоны
URI: geo/zone/create  

#### Входные параметры  
data - строка в формате JSON или NMEA GGA/GLL
name - название зоны
description - описание зоны
circle_id - id круга
params - координаты зоны
members - члены зоны

## Обновление данных зоны
URI: geo/zone/update  

## Удаление зоны
URI: geo/zone/destroy  

## Приглашение в зону по логину
URI: geo/zone/members/addbylogin 

#### Входные параметры 
geozone_id - id зоны
user_login - логин пользователя

## Приглашение в зону по имени
URI: geo/zone/members/addbyname

#### Входные параметры 
geozone_id - id зоны
user_name - логин пользователя

## Принятие отказ приглашения в зону
URI: geo/zone/confirm 

#### Входные параметры 
confirmation_token - токен приглашения
status - true=принятие, false=отказ (bool)

# Личные сообщения #

## Список сообщений сгруппированных по пользователю
URI: messages  
Метод: GET

#### Входные параметры  
offset 
#### Пример ответа  
[Объект MESSAGE](#message-object)

## Список сообщений конкретного пользователя
URI: messages/user  
Метод: GET  
[Объект MESSAGE](#message-object)

## Отправка сообщения
URI: messages/send  
Метод: POST  
#### Входные параметры  
user_id - получатель сообщения
text - текст сообщения

#### Пример ответа  
[Объект MESSAGE](#message-object)


## Пометка о прочтении сообщения
URI: messages/read  
Метод: POST  
#### Входные параметры  
id - id сообщения (нескольких через запятую)
#### Пример ответа
[Объект MESSAGE](#message-object)

## Восстановление удаленного сообщения
URI: messages/restore  
Метод: POST  
#### Входные параметры
id - id сообщения (нескольких через запятую)
#### Пример ответа
[Объект MESSAGE](#message-object)

## Удаление сообщения
URI: messages/destroy  
Метод: POST  
#### Входные параметры
id - id сообщения (нескольких через запятую)

# Оповещения системы #

## Отметка оповещения как прочитанного
URI: alerts/markread
Метод: GET
#### Входные параметры
id - id оповещения


## Оповещения
URI: alerts/receive

#### Пример ответа
[
    {
        "type": 10,
        "data": [Объект ALERT](#alert-object),
    },
    {
        "type": 100,
        "data": [Объект CONFIRM](#confirm-object),
    },
]


# Объекты API #

## USER object ##
    {
        "id": "",
        "name": "",
        "user_email": "",
        "user_profile_image": "",
        "status": {
            "is_online":false
            "last_updated":1374656913
        },
        "current_position": {
            "lat":55.682153,
            "lon":37.493852,
        },
        "circles": [
            CIRCLE TRIMMED Object,
            CIRCLE TRIMMED Object,
        ]
    }
## USER TRIMMED object ##
    {
        "id":0,
        "name":"",
        "user_profile_image":"",
        "status": {
            "is_online":false
            "last_updated":1374656913
        },
        "current_position": {
            "lat":55.682153,
            "lon":37.493852,
        }
    }

## CIRCLE object ##
    {
        "id":"",
        "name": "",
        "description": "",
        "members": [
            USER TRIMMED Object,
            USER TRIMMED Object
        ],
        "geozones": [
            GEOZONES Object
        ],
        "creator": 0,
        "is_public":false
        "status": {
            "last_updated"::1374656913
        }
    }

## CIRCLE TRIMMED object ##
    {
        "id":"",
        "name": "",
        "members": [
            USER TRIMMED Object,
            USER TRIMMED Object
        ],
        "creator_id": 0,
    }

## DEVICE object ##
    {
        "id":"",
        "uuid":"",
        "name":"",
        "status": {
            "is_online":false
            "last_updated":1374656913
        },
        "current_position": {
            "lat":55.682153,
            "lon":37.493852,
        }
    }

## GEOZONE object ##
    {
        "id":0,
        "name":"",
        "description": "",
        "circle_id":""
        "creator": USER TRIMMED Object
        "created":"",
        "expires":"",
        "type": "circle",
        params: {
            "lat":55.682153,
            "lon":37.493852,
            "radius":10 
        },
        "members": 
        [
            {
                "user_id":8,
                "type":"in",
                "value":true
            },
            {
                "user_id":8,
                "type":"out",
                "value":false
            }
        ]
    }

## GEOZONE object ##
    {
        "id":0,
        "name":"",
        "description": "",
        "circle_id":""
        "creator": USER TRIMMED Object
        "created":"",
        "expires":"",
        "type": "circle",
        params: {
            "lat":55.682153,
            "lon":37.493852,
            "radius":10 
        },
    }

## POSITION object ##
    {
        "lat": 55.682153,
        "lon": 37.493852,
        "created": 1374656913
    }

## MESSAGE object
    {
        "message_id":"",
        "from": USER TRIMMED object,
        "to": USER TRIMMED object,
        "text":""
        "created":1374656913
        "is_read":true
    }

## ALERT object
    {
        "id": 0,
        "source": USER TRIMMED object,
        "text": "",
        "created": 1374656913,
        "is_read": true,
    }
## CONFIRM object 
    {
        "token": "",
        "text": "",
        "created": 1374656913,
        "circle": CIRCLE TRIMMED object || [],
        "sender": USER TRIMMED object,
    }
## ERROR object
    {
        "code: 1000,
        "msg": "Access denied"
    }
